<!doctype html>
<html lang="pt-PT">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <meta name="theme-color" content="#0b1220"/>
  <title>Património Familiar</title>
  <meta name="description" content="Dashboard simples para acompanhar património familiar (ativos, passivos, distribuição, rendimento passivo e balanço). Tudo local, sem backend.">

  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="assets/favicon-32.png" sizes="32x32" type="image/png">
  <link rel="apple-touch-icon" href="assets/icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="Património">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link rel="stylesheet" href="styles.css">
  <script defer src="app.js"></script>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <img class="brand__icon" src="assets/icon-192.png" alt="Ícone">
      <div class="brand__text">
        <div class="brand__title">Património Familiar</div>
        <div class="brand__sub">Net worth • Distribuição • Rendimento passivo</div>
      </div>
    </div>
    <div class="topbar__actions">
      <button id="btnAddQuick" class="btn btn--primary" title="Adicionar">＋</button>
    </div>
  </header>

  <main>
    <!-- DASHBOARD -->
    <section id="page-dashboard" class="page">
      <div class="card">
        <div class="h2">Património líquido</div>
        <div class="kpi__value" id="kpiNetWorth">—</div>
        <div class="muted" id="kpiSub">Ativos — | Passivos —</div>
        <div class="row" style="margin-top:12px">
          <div class="kpi">
            <div class="kpi__label">Rendimento passivo (anual)</div>
            <div class="kpi__value" id="kpiPassiveYear">—</div>
          </div>
          <div class="kpi">
            <div class="kpi__label">Mensal (estim.)</div>
            <div class="kpi__value" id="kpiPassiveMonth">—</div>
          </div>
        </div>
        <div class="actions">
          <button class="btn" data-action="openAddAsset">+ Ativo</button>
          <button class="btn" data-action="openAddLiability">− Passivo</button>
          <button class="btn" data-action="snapshotMonth">⟲ Registar mês</button>
        </div>
      </div>

      <div class="card">
        <div class="h2">Distribuição por classe (Ativos)</div>
        <div class="chartbox">
          <canvas id="chartAlloc" height="240"></canvas>
        </div>
        <div id="allocPills" class="pills"></div>
        <div class="smallnote">Mostra apenas classes com valor &gt; 0.</div>
      </div>

      <div class="card">
        <div class="h2">Tendência do património</div>
        <div class="chartbox">
          <canvas id="chartTrend" height="220"></canvas>
        </div>
        <div class="actions" style="justify-content:space-between">
          <div class="muted" id="trendHint">Histórico (snapshots)</div>
          <button class="btn btn--ghost" data-action="clearHistory">Limpar</button>
        </div>
      </div>

      <div class="card">
        <div class="h2">Top 10 ativos (por valor)</div>
        <div id="top10List" class="list"></div>
        <div class="actions">
          <button class="btn btn--ghost" data-action="goAssets">Ver restantes</button>
        </div>
      </div>
    </section>

    <!-- ATIVOS -->
    <section id="page-assets" class="page" style="display:none">
      <div class="card">
        <div class="h1">Ativos</div>
        <div class="muted">Favoritos e lista completa. Edita tocando num item.</div>
        <div class="field">
          <label>Filtro</label>
          <select id="assetFilter">
            <option value="all">Todos</option>
            <option value="fav">Favoritos</option>
          </select>
        </div>
      </div>

      <div class="card">
        <div class="h2">Lista</div>
        <div id="assetsList" class="list"></div>
      </div>
    </section>

    <!-- IMPORTAR -->
    <section id="page-import" class="page" style="display:none">
      <div class="card">
        <div class="h1">Importar / Exportar</div>
        <div class="muted">Recomendado: CSV. XLSX é opcional (depende do teu export).</div>

        <div class="field">
          <label>Importar CSV (Ativos)</label>
          <input id="fileAssetsCsv" type="file" accept=".csv,text/csv">
          <div class="smallnote">Colunas: class,name,value,incomeType,incomeValue,notes,favorite</div>
        </div>

        <div class="field">
          <label>Importar CSV (Movimentos — Balanço)</label>
          <input id="fileTxCsv" type="file" accept=".csv,text/csv">
          <div class="smallnote">Colunas: date,kind,category,description,amount (kind: income|expense)</div>
        </div>

        <div class="actions">
          <button class="btn" data-action="exportJson">Exportar JSON (backup)</button>
          <button class="btn btn--ghost" data-action="importJson">Importar JSON</button>
          <input id="fileJson" type="file" accept="application/json" style="display:none">
        </div>
      </div>
    </section>

    <!-- BALANÇO -->
    <section id="page-balance" class="page" style="display:none">
      <div class="card">
        <div class="h1">Balanço</div>
        <div class="muted">Entradas e saídas por mês.</div>
        <div class="field">
          <label>Mês</label>
          <input id="balanceMonth" type="month">
        </div>
        <div class="row" style="margin-top:10px">
          <div class="kpi">
            <div class="kpi__label">Entradas</div>
            <div class="kpi__value" id="kpiIn">—</div>
          </div>
          <div class="kpi">
            <div class="kpi__label">Saídas</div>
            <div class="kpi__value" id="kpiOut">—</div>
          </div>
          <div class="kpi">
            <div class="kpi__label">Saldo</div>
            <div class="kpi__value" id="kpiNet">—</div>
          </div>
        </div>
        <div class="actions">
          <button class="btn" data-action="openAddIncome">+ Entrada</button>
          <button class="btn" data-action="openAddExpense">− Despesa</button>
          <button class="btn btn--ghost" data-action="applySalaryTemplate">Template Salários</button>
        </div>
      </div>

      <div class="card">
        <div class="h2">Movimentos</div>
        <div id="txList" class="list"></div>
      </div>
    </section>

    <!-- DEFINIÇÕES -->
    <section id="page-settings" class="page" style="display:none">
      <div class="card">
        <div class="h1">Definições</div>
        <div class="muted">Preferências locais (no dispositivo).</div>

        <div class="field">
          <label>Moeda base</label>
          <select id="baseCurrency">
            <option value="EUR">EUR (€)</option>
            <option value="USD">USD ($)</option>
            <option value="GBP">GBP (£)</option>
          </select>
        </div>

        <div class="field">
          <label>Impostos efectivos no rendimento passivo (%)</label>
          <input id="taxRate" type="number" inputmode="decimal" placeholder="ex: 28">
        </div>

        <div class="actions">
          <button class="btn btn--ghost" data-action="resetAll">Reset total (apaga dados)</button>
          <button class="btn btn--ghost" data-action="hardRefresh">Forçar refresh (limpar cache)</button>
        </div>

        <hr>
        <div class="muted smallnote">Armazenamento: localStorage (no teu iPhone/PC). Não há backend.</div>
      </div>
    </section>
  </main>

  <!-- bottom nav -->
  <nav class="bnav">
    <div class="bnav__inner">
      <button class="tabbtn tabbtn--active" data-tab="dashboard"><i>▣</i><span>Dashboard</span></button>
      <button class="tabbtn" data-tab="assets"><i>≡</i><span>Ativos</span></button>
      <button class="tabbtn" data-tab="import"><i>⇅</i><span>Importar</span></button>
      <button class="tabbtn" data-tab="balance"><i>€</i><span>Balanço</span></button>
      <button class="tabbtn" data-tab="settings"><i>⚙︎</i><span>Definições</span></button>
    </div>
  </nav>

  <!-- Modal (sheet) -->
  <div id="modal" class="modal" aria-hidden="true">
    <div class="sheet">
      <div class="sheet__top">
        <div id="modalTitle" class="sheet__title">—</div>
        <button class="iconbtn" data-action="closeModal" aria-label="Fechar">✕</button>
      </div>
      <hr>
      <div id="modalBody"></div>
    </div>
  </div>
</body>
</html>
